app:
  # Cloudtype 대시보드에 표시될 전체 애플리케이션의 이름입니다.
  name: discordbot-js

  # 사용할 런타임 환경을 지정합니다. Node.js 20.x 버전을 사용합니다.
  runtime: node@20



# 배포할 서비스들의 목록을 정의합니다.
services:

  # 여기에 봇 서비스 하나를 정의합니다.
  - name: app # 서비스의 고유 이름입니다.
    # 서비스의 타입을 Node.js로 지정합니다.
    type: node
    
    # 봇 실행에 필요한 패키지들을 설치하는 명령어입니다.
    # 기존 'yarn' 설정을 반영하고, cron-job에 필요한 패키지를 추가합니다.
    install: yarn install

    # 설치가 끝난 후 서비스를 시작하는 명령어입니다. (기존 설정 반영)
    start: yarn start

    # 서비스에 주입할 환경 변수들을 설정하는 부분입니다.
    # ✨✨ 기존의 모든 value를 안전한 secret 방식으로 변경했습니다. ✨✨
    env:

      # 형식: - name: [코드에서 사용할 환경변수 이름]
      #         secret: [Cloudtype Secret 그룹 이름]:[Secret 그룹 안의 키 이름]
      - name: DISCORD_BOT_TOKEN
        secret: discord-bot-secrets:DISCORD_BOT_TOKEN

      - name: FLOWISE_ENDPOINT
        secret: discord-bot-secrets:FLOWISE_ENDPOINT

      - name: FLOWISE_API_KEY
        secret: discord-bot-secrets:FLOWISE_API_KEY

      - name: DISCORD_CLIENT_ID
        secret: discord-bot-secrets:DISCORD_CLIENT_ID

      - name: DISCORD_GUILD_ID
        secret: discord-bot-secrets:DISCORD_GUILD_ID

      - name: EQK_API_KEY
        secret: discord-bot-secrets:EQK_API_KEY
